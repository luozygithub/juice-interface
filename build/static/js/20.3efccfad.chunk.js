(this["webpackJsonp@jbox/app"]=this["webpackJsonp@jbox/app"]||[]).push([[20],{2847:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return E}));var r=a(3),n=a(7),o=a(181),s=a(1132),c=a(47),i=a(13),l=a(127),d=a.n(l),u=a(0),j=a(2835),b=a(2836),p=a(2841),h=a(2828),v=a(2075),m=a(2074),y=a(2831),x=a(75);const O=e=>e*x.b*1e3;var k=a(1988),f=a.n(k),g=a(84);var w=a(11),S=a(145);var I=a(1);const z=d.a.now()-3e5;function E({style:{height:e},createdAt:t,projectId:a,cv:l}){const[x,k]=Object(u.useState)([]),[E,F]=Object(u.useState)(),[M,C]=Object(u.useState)(),[D,T]=Object(u.useState)("volume"),[A,W]=(({createdAt:e,now:t})=>{const[a,r]=Object(u.useState)();return Object(u.useEffect)((()=>{if(!e)return;const a=1e3*e;a>t-O(1)?r(1):a>t-O(7)?r(7):r(30)}),[e,t]),[a,r]})({createdAt:t,now:z}),{theme:{colors:B}}=Object(u.useContext)(i.a),K=e=>A?d()(1e3*e).format(A>1?"M/DD":"h:mma"):void 0;Object(u.useEffect)((()=>{A&&D&&(F(!0),k([]),C(void 0),(async({duration:e,now:t})=>new f.a(g.a).getEvery("days",d()(t-O(e+.1)).toISOString(),d()(t).toISOString(),e,!1).then((e=>{const a=[];for(let t=0;t<40;t++)a.push({block:Math.round((e[1].block-e[0].block)/40*t+e[0].block),timestamp:Math.round((e[1].timestamp-e[0].timestamp)/40*t+e[0].timestamp)});return a.push({block:null,timestamp:Math.round(t.valueOf()/1e3)}),a})))({duration:A,now:z}).then((async e=>{if(!a)return;const t=await(async({blockRefs:e,showGraph:t,projectId:a,cv:r})=>{const n=[],o=[];if(!e.length)return;let s;switch(t){case"volume":s=["totalPaid"];break;case"balance":s=["currentBalance"]}return e.forEach((e=>{const c=[];a&&c.push({key:"projectId",value:a}),r&&c.push({key:"cv",value:r});const i=null!==e.block?{block:{number:e.block}}:{};o.push(Object(S.d)({entity:"project",keys:s,...i,where:c}).then((a=>{if(!a.length)return;let r;a[0]&&a.forEach((a=>{switch(t){case"volume":r=parseFloat(parseFloat(Object(w.e)(a.totalPaid)).toFixed(4));break;case"balance":r=parseFloat(parseFloat(Object(w.e)(a.currentBalance)).toFixed(4))}void 0!==r&&n.push({timestamp:e.timestamp,value:r})}))})))})),await Promise.allSettled(o),n})({blockRefs:e,showGraph:D,projectId:a,cv:l});if(!t)return;const r=(e=>{let t,a;if(e.forEach((e=>{void 0!==e.value&&((void 0===a||e.value<a)&&(a=e.value),(void 0===t||e.value>t)&&(t=e.value))})),void 0===t||void 0===a)return[0,.1];{const e=.05*(t-a);return[Math.max(a-e,0),Math.max(t+e,.1)]}})(t);if(C(r),"balance"===D){const e=await(async({projectId:e,duration:t,now:a})=>(await Object(S.d)({entity:"tapEvent",keys:["netTransferAmount","timestamp"],where:e?[{key:"project",value:e.toString()},{key:"timestamp",value:Math.round((a-O(t))/1e3),operator:"gte"}]:void 0})).map((e=>{var t;return{...e,tapped:parseFloat(parseFloat(Object(w.e)(e.netTransferAmount)).toFixed(4)),timestamp:null!==(t=e.timestamp)&&void 0!==t?t:0}})))({projectId:a,duration:A,now:z});t.concat(e)}const n=t.sort(((e,t)=>e.timestamp<t.timestamp?-1:1)),o=n.map(((e,t)=>{var a;return e.tapped?{...e,previousBalance:null===(a=n[t-1])||void 0===a?void 0:a.value}:e}));k(o),F(!1)})))}),[l,A,a,D]);const J={fontSize:11,fill:B.text.tertiary,visibility:null!==x&&void 0!==x&&x.length?"visible":"hidden"},L=Object(u.useMemo)((()=>{if(null===x||void 0===x||!x.length)return[];const e=[],t=z/1e3,a=A?(z-O(A))/1e3:void 0;if(!a)return[];for(let r=0;r<20;r++)e.push(Math.round((t-a)/20*r+a));return e}),[x,A]),P=e=>{const t=e===D;let a;switch(e){case"balance":a=n.a._("In Juicebox");break;case"volume":a=n.a._("Volume")}return Object(I.jsx)("div",{style:{textTransform:"uppercase",fontSize:"0.8rem",fontWeight:t?600:400,color:t?B.text.secondary:B.text.tertiary,cursor:"pointer"},onClick:()=>T(e),children:a})};return Object(I.jsxs)("div",{children:[Object(I.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[Object(I.jsx)("div",{children:Object(I.jsxs)(o.b,{size:"large",children:[P("volume"),P("balance")]})}),Object(I.jsxs)(s.a,{className:"small",style:{fontSize:"0.7rem",textTransform:"uppercase",width:100},value:A,onChange:e=>W(e),children:[Object(I.jsx)(s.a.Option,{value:1,children:Object(I.jsx)(r.b,{id:"24 hours"})}),Object(I.jsx)(s.a.Option,{value:7,children:Object(I.jsx)(r.b,{id:"7 days"})}),Object(I.jsx)(s.a.Option,{value:30,children:Object(I.jsx)(r.b,{id:"30 days"})}),Object(I.jsx)(s.a.Option,{value:90,children:Object(I.jsx)(r.b,{id:"90 days"})}),Object(I.jsx)(s.a.Option,{value:365,children:Object(I.jsx)(r.b,{id:"1 year"})})]})]}),Object(I.jsxs)("div",{style:{position:"relative"},children:[Object(I.jsx)(j.a,{width:"100%",height:e,children:Object(I.jsxs)(b.a,{style:{opacity:E?.5:1},data:x,children:[Object(I.jsx)(p.a,{style:{paddingLeft:200},stroke:B.stroke.tertiary,strokeDasharray:"4 2"}),"balance"===D&&Object(I.jsx)(h.a,{dot:t=>{const{cx:a,payload:r}=t;return r.tapped&&M?Object(I.jsx)("g",{transform:`translate(${a},0)`,children:Object(I.jsx)("line",{x1:"0",y1:80-25*r.tapped/(M[1]-M[0])+"%",x2:"0",y2:e-35+"px",strokeWidth:4,stroke:B.stroke.secondary})}):Object(I.jsx)("span",{hidden:!0})},activeDot:!1,stroke:B.stroke.primary,strokeWidth:0,dataKey:"previousBalance"}),Object(I.jsx)(h.a,{dot:!1,connectNulls:!0,stroke:B.text.brand.primary,strokeWidth:2,type:"monotone",dataKey:"value",animationDuration:0}),Object(I.jsx)(v.a,{axisLine:!1,stroke:B.stroke.tertiary,type:"number",dataKey:"value",domain:M,scale:"linear",tickSize:2,tickCount:4,tick:J,mirror:!0}),Object(I.jsx)(m.a,{axisLine:!1,tickSize:4,stroke:B.stroke.tertiary,ticks:L,tickCount:L.length,tick:e=>{const{x:t,y:a,payload:r}=e;return Object(I.jsx)("g",{transform:`translate(${t},${a})`,children:Object(I.jsx)("text",{dy:12,...J,children:K(r.value)})})},domain:[L[0],L[L.length-1]],type:"number",dataKey:"timestamp",scale:"time",interval:2}),Object(I.jsx)(y.a,{contentStyle:{background:B.background.l0,border:"1px solid "+B.stroke.secondary,fontSize:"0.8rem"},cursor:{stroke:B.stroke.secondary},content:({active:e,payload:t})=>e&&null!==t&&void 0!==t&&t.length?Object(I.jsxs)("div",{style:{padding:10,background:B.background.l0,border:"1px solid "+B.stroke.tertiary},children:[Object(I.jsx)("div",{style:{fontSize:"0.7rem",color:B.text.tertiary},children:K(t[0].payload.timestamp)}),t[0].payload.tapped?Object(I.jsxs)("div",{children:["-",Object(I.jsx)(c.a,{currency:"ETH"}),t[0].payload.tapped,Object(I.jsx)("div",{style:{fontSize:"0.7rem",fontWeight:500,color:B.text.secondary},children:"withdraw"})]}):Object(I.jsxs)("div",{children:[Object(I.jsx)(c.a,{currency:"ETH"}),t[0].payload.value]})]}):null,animationDuration:100})]})}),E&&Object(I.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",left:0,top:0,right:0,bottom:20},children:Object(I.jsxs)("div",{style:{color:B.text.disabled},children:[Object(I.jsx)(r.b,{id:"loading"}),"..."]})})]})]})}}}]);
//# sourceMappingURL=20.3efccfad.chunk.js.map